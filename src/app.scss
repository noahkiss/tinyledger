// ==========================================================================
// TinyLedger - Main Stylesheet
// ==========================================================================

// 1. Palette (must come before Bulma)
@use "styles/palette" as p;

// 2. Bulma with palette overrides
@use "bulma/sass" with (
  $primary: p.$primary,
  $link: p.$link,
  $info: p.$info,
  $success: p.$success,
  $warning: p.$warning,
  $danger: p.$danger,
  $scheme-main: p.$scheme-main,
  $text: p.$text,
  $text-strong: p.$text-strong,
  $family-primary: p.$family-primary,
  $input-shadow: none,
  $control-border-width: 1px
);

// 3. App color tokens (bridges Bulma vars to app semantic tokens)
@use "styles/colors";

// ==========================================================================
// Bulma Overrides â€” Shadows & Surfaces
// Bulma's defaults are too heavy: 0.5em blur glow + white shadow in dark mode.
// Match the subtle shadow-sm style from our previous Tailwind setup.
// ==========================================================================

:root {
  // Subtle shadow matching Tailwind's shadow-sm
  --bulma-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);

  // Per-component shadow tuning
  --bulma-box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.06), 0 0 0 1px rgba(0, 0, 0, 0.02);
  --bulma-card-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.06), 0 0 0 1px rgba(0, 0, 0, 0.02);
  --bulma-card-header-shadow: 0 1px 0 0 var(--bulma-border-weak);
  --bulma-panel-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.06);
  --bulma-dropdown-content-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.12);

  // Fix washed-out surface differentiation (Bulma generates 96-98% from our 95%)
  --bulma-scheme-main-bis-l: 92%;
  --bulma-scheme-main-ter-l: 89%;
}

// Dark mode: use dark shadows (Bulma defaults to white glow!)
[data-theme="dark"] {
  --bulma-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.4);
  --bulma-box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.03);
  --bulma-card-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.03);
  --bulma-card-header-shadow: 0 1px 0 0 rgba(255, 255, 255, 0.06);
  --bulma-panel-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3);
  --bulma-dropdown-content-shadow: 0 4px 12px 0 rgba(0, 0, 0, 0.5);

  // Override Bulma's dark scheme to match Catppuccin Mocha
  --bulma-scheme-main: #1e1e2e;
  --bulma-scheme-main-bis: #181825;
  --bulma-scheme-main-ter: #11111b;
  --bulma-text: #cdd6f4;
  --bulma-text-strong: #cdd6f4;
  --bulma-text-weak: #a6adc8;
  --bulma-border: #6c7086;
  --bulma-border-weak: #45475a;

  // Fix shadow color channels (prevent white glow)
  --bulma-shadow-h: 0;
  --bulma-shadow-s: 0%;
  --bulma-shadow-l: 0%;
}

@media (prefers-color-scheme: dark) {
  :root:not([data-theme="light"]):not(.theme-light) {
    --bulma-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.4);
    --bulma-box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.03);
    --bulma-card-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.03);
    --bulma-card-header-shadow: 0 1px 0 0 rgba(255, 255, 255, 0.06);
    --bulma-panel-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3);
    --bulma-dropdown-content-shadow: 0 4px 12px 0 rgba(0, 0, 0, 0.5);

    --bulma-scheme-main: #1e1e2e;
    --bulma-scheme-main-bis: #181825;
    --bulma-scheme-main-ter: #11111b;
    --bulma-text: #cdd6f4;
    --bulma-text-strong: #cdd6f4;
    --bulma-text-weak: #a6adc8;
    --bulma-border: #6c7086;
    --bulma-border-weak: #45475a;

    --bulma-shadow-h: 0;
    --bulma-shadow-s: 0%;
    --bulma-shadow-l: 0%;
  }
}

// ==========================================================================
// App-specific styles (things Bulma doesn't provide)
// ==========================================================================

// Tabular numbers for financial data
.tabular-nums {
  font-variant-numeric: tabular-nums;
}

[data-currency],
.currency {
  font-variant-numeric: tabular-nums;
  font-feature-settings: "tnum" 1;
}

// Prose content: constrain line length for readability
.prose-content {
  max-width: 65ch;
}

// Dark-mode conditional visibility (used by footer images)
[data-theme="dark"] .light-only,
.theme-dark .light-only { display: none; }
[data-theme="dark"] .dark-only,
.theme-dark .dark-only { display: block; }
.dark-only { display: none; }

@media (prefers-color-scheme: dark) {
  :root:not([data-theme="light"]):not(.theme-light) {
    .light-only { display: none; }
    .dark-only { display: block; }
  }
}

// ==========================================================================
// Base Overrides
// ==========================================================================

html {
  background-color: var(--color-background);
  color: var(--color-foreground);
  font-size: 100%;
}

body {
  background-color: var(--color-background);
  color: var(--color-foreground);
  min-height: 100vh;
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

// Respect reduced motion preference
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}
