---
phase: 07.1-filings
plan: 01
subsystem: database
tags: [drizzle, sqlite, filings, compliance, tax-forms]

# Dependency graph
requires:
  - phase: 07-tax-system
    provides: workspace tax configuration, quarterly payments pattern
provides:
  - filings table in database schema
  - FilingDefinition interface with deadline calculation
  - SOLE_PROP_FILINGS array (11 filings)
  - VOLUNTEER_ORG_FILINGS array (2 filings)
  - getFilingsForWorkspace() utility
  - getFilingDeadline() utility
affects: [07.1-02, filings-ui, taxes-page-link]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - Filing definitions with inline deadline calculator functions
    - State-specific filing filtering via applicableStates array

key-files:
  created:
    - src/lib/data/filing-forms.ts
  modified:
    - src/lib/server/db/schema.ts

key-decisions:
  - "Filing definitions use getDeadline function per filing for flexibility"
  - "Q4 quarterly filings return Jan 15 of next year (fiscalYear + 1)"
  - "990-N deadline calculates to 5th month after FY end (May 15 for calendar year)"
  - "BCO-10 due date uses Nov 15 as proxy for anniversary-based deadline"

patterns-established:
  - "FilingDefinition interface with embedded deadline calculator"
  - "State filtering via applicableStates array (undefined = federal)"

# Metrics
duration: 6min
completed: 2026-02-02
---

# Phase 7.1 Plan 01: Schema and Filing Definitions Summary

**Database filings table and complete filing definitions for sole prop (Schedule C, SE, 1040-ES, PA forms) and volunteer org (990-N, BCO-10) workspace types**

## Performance

- **Duration:** 6 min
- **Started:** 2026-02-02T15:10:27Z
- **Completed:** 2026-02-02T15:16:38Z
- **Tasks:** 2
- **Files modified:** 2

## Accomplishments

- Added filings table to schema.ts with fiscalYear, formId, filedAt, confirmationNumber, notes columns
- Created FilingDefinition interface with inline deadline calculation
- Defined 11 sole proprietor filings: Schedule C, SE, 4x 1040-ES quarters, PA-40, 4x PA-40 ES quarters
- Defined 2 volunteer organization filings: 990-N (e-Postcard), BCO-10 (PA only)
- Implemented getFilingsForWorkspace() filtering by workspace type and state
- Implemented getFilingDeadline() with correct Q4 edge case (Jan 15 next year)

## Task Commits

Each task was committed atomically:

1. **Task 1: Extend schema with filings table** - `8706fe0` (feat)
2. **Task 2: Create filing definitions data file** - `1810cec` (feat)

## Files Created/Modified

- `src/lib/server/db/schema.ts` - Added filings table with Filing/NewFiling types
- `src/lib/data/filing-forms.ts` - Filing definitions, utility functions

## Decisions Made

- **Deadline calculation via function:** Each filing definition has a `getDeadline(fiscalYear)` function allowing flexible per-filing logic
- **Q4 payment edge case:** Returns `fiscalYear + 1` for January 15 deadline
- **990-N due date:** Calendar year assumption (May 15 of next year)
- **BCO-10 due date:** Using Nov 15 as proxy for "30 days after anniversary" rule

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- filings table ready for database migrations
- Filing definitions complete for Plan 02 UI implementation
- getFilingsForWorkspace() ready for page.server.ts integration
- Ready to build Filings tab UI with card-based layout

---
*Phase: 07.1-filings*
*Completed: 2026-02-02*
