---
phase: 09-mobile-deployment
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - static/manifest.webmanifest
  - static/icons/icon-180.png
  - static/icons/icon-192.png
  - static/icons/icon-512.png
  - static/icons/icon-512-maskable.png
  - static/icons/icon.svg
  - src/app.html
  - src/lib/components/OfflineIndicator.svelte
  - src/routes/+layout.svelte
  - src/routes/w/[workspace]/settings/+page.svelte
autonomous: true

must_haves:
  truths:
    - "App is installable to iOS home screen from Safari"
    - "App shows 'Ledger' name on home screen"
    - "App runs in standalone mode (no Safari chrome)"
    - "Offline indicator banner appears when network is disconnected"
  artifacts:
    - path: "static/manifest.webmanifest"
      provides: "PWA manifest with name, icons, display mode"
      contains: "\"display\": \"standalone\""
    - path: "static/icons/icon-180.png"
      provides: "Apple touch icon"
    - path: "static/icons/icon-512.png"
      provides: "PWA splash icon"
    - path: "src/app.html"
      provides: "PWA meta tags and manifest link"
      contains: "apple-touch-icon"
    - path: "src/lib/components/OfflineIndicator.svelte"
      provides: "Offline detection and banner display"
      min_lines: 15
  key_links:
    - from: "src/app.html"
      to: "static/manifest.webmanifest"
      via: "link rel=manifest"
      pattern: "rel=\"manifest\""
    - from: "src/app.html"
      to: "static/icons/icon-180.png"
      via: "apple-touch-icon link"
      pattern: "apple-touch-icon"
    - from: "src/routes/+layout.svelte"
      to: "src/lib/components/OfflineIndicator.svelte"
      via: "component import and render"
      pattern: "OfflineIndicator"
---

<objective>
Configure the app as an installable PWA for iOS home screen with proper manifest, icons, and offline indicator.

Purpose: Make the app installable to iOS home screen with a native-like standalone experience, while clearly indicating when the user is offline (since offline mode is not supported).

Output: manifest.webmanifest, PWA icons in multiple sizes, updated app.html with iOS-specific elements, OfflineIndicator component displayed in root layout.
</objective>

<execution_context>
@/home/flight/.claude/get-shit-done/workflows/execute-plan.md
@/home/flight/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-mobile-deployment/09-CONTEXT.md
@.planning/phases/09-mobile-deployment/09-RESEARCH.md
@src/app.html
@src/routes/+layout.svelte
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PWA icons and manifest</name>
  <files>
    static/icons/icon.svg
    static/icons/icon-180.png
    static/icons/icon-192.png
    static/icons/icon-512.png
    static/icons/icon-512-maskable.png
    static/manifest.webmanifest
  </files>
  <action>
Create PWA icons following the "abstract L monogram" direction from CONTEXT.md:

1. Create `static/icons/` directory

2. Create `static/icons/icon.svg` - Abstract L monogram design:
   - Simple geometric L shape
   - Blue color (#2563eb - Tailwind blue-600, matches app's button color)
   - White background for contrast
   - Minimal, modern aesthetic

3. Use sharp to generate PNG icons from the SVG:
   - icon-180.png (180x180) - Apple touch icon
   - icon-192.png (192x192) - PWA minimum
   - icon-512.png (512x512) - PWA splash
   - icon-512-maskable.png (512x512 with 10% safe zone padding) - Android adaptive icon

4. Create `static/manifest.webmanifest` (NOT .json - Vite conflict):
```json
{
  "name": "Ledger",
  "short_name": "Ledger",
  "description": "Lightweight ledger for sole proprietors",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#2563eb",
  "icons": [
    { "src": "/icons/icon-192.png", "sizes": "192x192", "type": "image/png" },
    { "src": "/icons/icon-512.png", "sizes": "512x512", "type": "image/png" },
    { "src": "/icons/icon-512-maskable.png", "sizes": "512x512", "type": "image/png", "purpose": "maskable" }
  ]
}
```

Note: Use .webmanifest extension to avoid conflict with Vite's internal manifest.json.
  </action>
  <verify>
- `ls static/icons/` shows all 5 files (1 SVG + 4 PNGs)
- `cat static/manifest.webmanifest` shows valid JSON with "display": "standalone"
- PNG files are correct sizes (use `file static/icons/*.png` to verify)
  </verify>
  <done>
PWA manifest and all required icon sizes exist in static/icons/.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update app.html with PWA meta tags</name>
  <files>src/app.html</files>
  <action>
Update `src/app.html` to add PWA and iOS-specific elements in the `<head>`:

1. Add manifest link:
   `<link rel="manifest" href="/manifest.webmanifest" />`

2. Add Apple touch icon:
   `<link rel="apple-touch-icon" href="/icons/icon-180.png" />`

3. Add theme-color meta:
   `<meta name="theme-color" content="#2563eb" />`

4. Add apple-mobile-web-app-title:
   `<meta name="apple-mobile-web-app-title" content="Ledger" />`

5. Keep existing meta tags (apple-mobile-web-app-capable is already present)

6. Update favicon to use the new icon:
   `<link rel="icon" href="/icons/icon-192.png" />`

Remove the old `%sveltekit.assets%/favicon.png` reference since we're using the new icons.
  </action>
  <verify>
- `grep -E "manifest|apple-touch-icon|theme-color" src/app.html` shows all required elements
- `npm run build` succeeds (no manifest conflict)
  </verify>
  <done>
app.html includes all PWA meta tags and iOS-specific elements.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create OfflineIndicator component and add to layout</name>
  <files>
    src/lib/components/OfflineIndicator.svelte
    src/routes/+layout.svelte
    src/routes/w/[workspace]/settings/+page.svelte
  </files>
  <action>
1. Create `src/lib/components/OfflineIndicator.svelte`:
   - Use $state to track online status
   - Use $effect to add/remove online/offline event listeners
   - Initialize with navigator.onLine
   - When offline, show fixed banner at top: "You're offline - connect to continue"
   - Style: yellow background (bg-yellow-100), yellow text (text-yellow-800), centered, full width
   - Banner should be fixed at the top of viewport

Pattern from RESEARCH.md:
```svelte
<script lang="ts">
  let online = $state(true);

  $effect(() => {
    const handleOnline = () => online = true;
    const handleOffline = () => online = false;

    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);
    online = navigator.onLine;

    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  });
</script>

{#if !online}
  <div class="fixed top-0 left-0 right-0 z-50 bg-yellow-100 text-yellow-800 px-4 py-2 text-center text-sm font-medium">
    You're offline - connect to continue
  </div>
{/if}
```

2. Update `src/routes/+layout.svelte`:
   - Import OfflineIndicator component
   - Render it at the top (before children)
   - Keep existing favicon handling

3. Update `src/routes/w/[workspace]/settings/+page.svelte`:
   - Add a new section at the bottom for "App Installation"
   - Include instructions for installing to iOS home screen:
     - "To install on iOS: tap the Share button in Safari, then 'Add to Home Screen'"
   - This is the user's preferred discovery method (Settings page only, no banner prompts)
  </action>
  <verify>
- Component exists and has online/offline event handling
- Root layout imports and renders OfflineIndicator
- Settings page has "App Installation" section with iOS instructions
- `npm run check` passes
  </verify>
  <done>
OfflineIndicator component shows banner when offline. Settings page includes PWA install instructions.
  </done>
</task>

</tasks>

<verification>
1. Build succeeds: `npm run build`
2. Type check passes: `npm run check`
3. Manifest is accessible: After `npm run preview`, check http://localhost:4173/manifest.webmanifest
4. Icons are accessible: http://localhost:4173/icons/icon-180.png
5. PWA is installable: Open in Chrome DevTools > Application > Manifest shows valid manifest
</verification>

<success_criteria>
- manifest.webmanifest exists with correct structure (display: standalone, icons, name: Ledger)
- All 4 PNG icons exist at correct sizes (180, 192, 512, 512-maskable)
- app.html has manifest link, apple-touch-icon, theme-color, and apple-mobile-web-app-title
- OfflineIndicator component displays yellow banner when network is disconnected
- Settings page includes "App Installation" section with iOS instructions
- Build completes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/09-mobile-deployment/09-01-SUMMARY.md`
</output>
