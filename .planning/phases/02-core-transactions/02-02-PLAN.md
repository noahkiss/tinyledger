---
phase: 02-core-transactions
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/lib/components/CurrencyInput.svelte
  - src/lib/components/DateInput.svelte
  - src/lib/components/TagSelector.svelte
  - src/lib/components/PaymentMethodSelect.svelte
autonomous: true

must_haves:
  truths:
    - "Currency input shows $ prefix and auto-formats to 2 decimals on blur"
    - "Date input accepts MM/DD/YYYY and MMDDYYYY formats, normalizes to YYYY-MM-DD"
    - "Date input warns when date is more than 1 year in future"
    - "Tag selector validates percentages sum to exactly 100%"
    - "Payment method selector shows check number field only when check selected"
  artifacts:
    - path: "src/lib/components/CurrencyInput.svelte"
      provides: "Auto-formatting currency input with cents binding"
      min_lines: 40
    - path: "src/lib/components/DateInput.svelte"
      provides: "Flexible date input with future warning"
      min_lines: 50
    - path: "src/lib/components/TagSelector.svelte"
      provides: "Multi-tag selector with percentage allocation"
      min_lines: 80
    - path: "src/lib/components/PaymentMethodSelect.svelte"
      provides: "Payment method radio group with check number"
      min_lines: 40
  key_links:
    - from: "CurrencyInput"
      to: "currency utils"
      via: "import dollarsToCents"
      pattern: "from.*currency"
    - from: "TagSelector"
      to: "Tag type"
      via: "type import"
      pattern: "type.*Tag"
---

<objective>
Create reusable input components for transaction forms: currency, date, tags, and payment method.

Purpose: Provide mobile-friendly, auto-formatting inputs that match the requirements for 10-second transaction entry. These components will be used in both create and edit transaction forms.

Output: Four Svelte 5 components using $state, $derived, and $bindable for reactive form handling.
</objective>

<execution_context>
@/home/flight/.claude/get-shit-done/workflows/execute-plan.md
@/home/flight/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-core-transactions/02-RESEARCH.md
@src/lib/utils/currency.ts
@src/lib/server/db/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CurrencyInput and DateInput components</name>
  <files>
    src/lib/components/CurrencyInput.svelte
    src/lib/components/DateInput.svelte
  </files>
  <action>
**CurrencyInput.svelte:**
Create a text input that displays currency with $ prefix and auto-formats on blur.

Props (using Svelte 5 $props syntax):
- value: number = $bindable(0) - Value in CENTS (integer)
- name: string = 'amount'
- id: string = 'amount'
- required: boolean = false
- class: string = '' (for styling)

Behavior:
- Display value formatted as dollars (e.g., "12.50" not "1250")
- Show $ prefix as static text positioned inside input
- On input: update display value freely
- On blur: parse to cents, reformat display (e.g., "12.5" becomes "12.50")
- On focus: select all text for easy replacement
- Use inputmode="decimal" for mobile numeric keyboard
- Include hidden input with {name}_cents that submits the cents value

Import dollarsToCents from '$lib/utils/currency'.

Use Tailwind classes: pl-7 for left padding (to accommodate $), rounded-lg, border, px-3, py-2.

**DateInput.svelte:**
Create a date input that accepts flexible formats and shows native mobile picker.

Props:
- value: string = $bindable('') - ISO date string YYYY-MM-DD
- name: string = 'date'
- id: string = 'date'
- required: boolean = false
- class: string = ''

Behavior:
- Use native HTML5 type="date" input for mobile picker support
- On blur: parse flexible formats (MM/DD/YYYY, M/D/YYYY, MMDDYYYY) to ISO
- Use $derived for showFutureWarning: true if date > 1 year from now
- Display amber warning text below input when future date detected

Flexible date parsing function:
- Already ISO format: return as-is
- MM/DD/YYYY or M/D/YYYY: convert to YYYY-MM-DD
- MMDDYYYY (8 digits): parse as month/day/year
  </action>
  <verify>
Run `npx tsc --noEmit` to verify TypeScript compiles.
Both component files exist: `ls src/lib/components/{Currency,Date}Input.svelte`
  </verify>
  <done>
CurrencyInput auto-formats with $ prefix and binds value in cents.
DateInput accepts flexible formats, normalizes to ISO, warns on future dates.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create TagSelector component</name>
  <files>src/lib/components/TagSelector.svelte</files>
  <action>
Create a dynamic form for selecting multiple tags with percentage allocation.

Props:
- availableTags: Tag[] = [] - Array of tag objects from database
- allocations: TagAllocation[] = $bindable([]) - Array of {tagId, percentage}

Internal type:
```typescript
type TagAllocation = {
  tagId: number;
  percentage: number;
};
```

Behavior:
- Each allocation row shows: tag dropdown, percentage input, remove button
- "Add Tag" button adds a new allocation with remaining percentage
- $derived totalPercentage: sum of all percentages
- $derived isValid: totalPercentage === 100
- $derived remainingPercentage: 100 - totalPercentage
- "Add remaining to last" helper button when sum < 100

Validation display:
- Show "Total: X%" in green when valid (100%), red when invalid
- Show error message when percentages don't sum to 100%
- Show helper button to auto-distribute remaining percentage

Form field names: tag_{i} for tag select, percentage_{i} for percentage input.

Use Tailwind: flex, gap-2, items-center for row layout. w-20 for percentage input.

SVG X icon for remove button (inline SVG, not external icon library).

Handle empty availableTags gracefully (no dropdown options).
  </action>
  <verify>
Run `npx tsc --noEmit` to verify TypeScript compiles.
Component file exists: `test -f src/lib/components/TagSelector.svelte && echo "exists"`
  </verify>
  <done>
TagSelector allows adding/removing tags, validates percentage sum to 100%, shows clear validation feedback.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create PaymentMethodSelect component</name>
  <files>src/lib/components/PaymentMethodSelect.svelte</files>
  <action>
Create a radio button group for payment method with conditional check number field.

Props:
- value: 'cash' | 'card' | 'check' = $bindable('cash')
- checkNumber: string = $bindable('')
- name: string = 'paymentMethod'

Behavior:
- Three radio buttons: Cash, Card, Check
- Radio buttons styled as pill buttons (horizontal row)
- When 'check' is selected, show text input for check number
- Check number input only visible when paymentMethod === 'check'
- Use $derived to control visibility: showCheckNumber = value === 'check'

Styling:
- Radio group as horizontal flex row with gap
- Each option as a label with hidden radio, styled button appearance
- Selected state: bg-blue-600 text-white
- Unselected state: bg-gray-100 text-gray-700 hover:bg-gray-200
- Check number input appears below with "Check #" label
- Use peer/checked CSS pattern or simple onclick handlers

Form field names: paymentMethod (radios), checkNumber (text input).
  </action>
  <verify>
Run `npx tsc --noEmit` to verify TypeScript compiles.
Component file exists: `test -f src/lib/components/PaymentMethodSelect.svelte && echo "exists"`
  </verify>
  <done>
PaymentMethodSelect has three styled radio options and conditional check number field.
  </done>
</task>

</tasks>

<verification>
- [ ] `npx tsc --noEmit` passes
- [ ] All four component files exist in src/lib/components/
- [ ] CurrencyInput has inputmode="decimal" for mobile
- [ ] DateInput uses native type="date" input
- [ ] TagSelector validates percentage sum in real-time
- [ ] PaymentMethodSelect conditionally shows check number
</verification>

<success_criteria>
1. CurrencyInput: $ prefix visible, value binds as cents, formats on blur
2. DateInput: Flexible parsing works, future warning displays, native picker works on mobile
3. TagSelector: Add/remove tags, percentage inputs validate sum, clear error messages
4. PaymentMethodSelect: Radio styling works, check number shows only for check
5. All components use Svelte 5 $props, $state, $derived, $bindable syntax
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-transactions/02-02-SUMMARY.md`
</output>
